#!/bin/bash
set -e

source "$(dirname $0)/version"
cd "$(dirname $0)/.."

rm -rf ./bin/* ./dist/*

BUILD_TARGET="${BUILD_TARGET:-dev}"

if [ -n "$CROSS" ]; then 
    BUILD_TARGET="prod"
fi

BUILD_ARG="${BUILD_ARG:-} --skip validate --id ${BUILD_TARGET}"

mkdir -p "./bin"

# upx is handled  by goreleaser
VERSION=${VERSION} COMMIT=${COMMIT} goreleaser build $BUILD_ARG

mkdir -p "./dist"

cp -r bin/kube-explorer-* dist/
